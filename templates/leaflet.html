{% extends 'base.html' %}
{% load static %}
{% block css %}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
          integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
          crossorigin=""/>
    <style>
        #mapid {
            height: 400px;
        }

    </style>

{% endblock %}
{% block js %}
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
            integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
            crossorigin=""></script>
    <script src="{% static 'proj4.js' %}"></script>

    <script src="{% static 'proj4leaflet.js' %}"></script>
{% endblock %}
{% block contenido %}
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div id="mapid"></div>
            </div>
        </div>
    </div>



{% endblock %}
{% block postjs %}
    <script>
        // A $( document ).ready() block.
        $(document).ready(function () {

            var crs = new L.Proj.CRS('EPSG:32718', "+proj=utm +zone=18 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs",
                {
                    resolutions: [8192, 4096, 2048] // 3 example zoom level resolutions
                }
            );
            var mymap = L.map('mapid', {
                crs: crs,
                center: [-13.1658892, -74.2159722],
                zoom: 9
            });
            //setView([-13.1658892, -74.2159722], 16);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(mymap);

            {#var myLayer = L.geoJSON().addTo(mymap);#}
            {#axios.get('http://localhost:8000/api/per/5/')#}
            {#    .then(function (response) {#}
            {#        // handle success#}
            {#        console.log(response);#}
            {#        myLayer.addData(response.data.geom)#}
            {##}
            {#    })#}
            {#    .catch(function (error) {#}
            {#        // handle error#}
            {#        console.log(error);#}
            {#    })#}
            {#    .finally(function () {#}
            {#        // always executed#}
            {#    }); #}
            {##}
            {##}

            /*
                     L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
                         maxZoom: 18,
                         attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                             '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                             'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
                         id: 'mapbox.streets'
                     }).addTo(mymap);

                     atLng(-13.132979, -74.278564)
                                 L.marker([51.5, -0.09]).addTo(mymap)
                                     .bindPopup("<b>Hello world!</b><br />I am a popup.").openPopup();

                                 L.circle([51.508, -0.11], 500, {
                                     color: 'red',
                                     fillColor: '#f03',
                                     fillOpacity: 0.5
                                 }).addTo(mymap).bindPopup("I am a circle.");

                                 L.polygon([
                                     [51.509, -0.08],
                                     [51.503, -0.06],
                                     [51.51, -0.047]
                                 ]).addTo(mymap).bindPopup("I am a polygon.");

                     */
            {#var popup = L.popup();#}
            {##}
            {#function onMapClick(e) {#}
            {#    popup#}
            {#        .setLatLng(e.latlng)#}
            {#        .setContent("You clicked the map at " + e.latlng.toString())#}
            {#        .openOn(mymap);#}
            {# }#}
            {##}
            {#mymap.on('click', onMapClick);#}

        });
    </script>
{% endblock %}